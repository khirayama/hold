<!DOCTYPE html>
<html>
  <head>
  <title>Sample</title>
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script>
function crud($parent, resources, template, data) {
  $.ajax({
    type: 'GET',
    url: `/api/v1/${resources}`
  }).done(function(res) {
    res.forEach(function (resource) {
      $parent.find('.index-list').append(template(resource));
    });
  });

  $parent.find('.create-button').on('click', function(event) {
    var data = {};
    var $box = $parent.find('.create-box');
    $box.find('input').each((index, input) => {
      var $input = $(input);
      data[$input.attr('name')] = $input.val();
    });
    $.ajax({
      type: 'POST',
      url: `/api/v1/${resources}`,
      data: data
    }).done(function(res) {
      location.reload();
    });
  });

  $parent.on('click', '.edit-button', function(event) {
    var data = $(event.target).data('content');
    var $box = $parent.find('.update-box');
    $box.find('input').each(function(index, input) {
      var $input = $(input);
      var key = $input.attr('name');
      $input.val(data[key]);
    });
  });

  $parent.on('click', '.update-button', function(event) {
    var data = {};
    var $box = $parent.find('.update-box');
    var id = $parent.find('input[name="id"]').val();
    $box.find('input').each((index, input) => {
      var $input = $(input);
      if ($input.attr('name') != 'id') {
        data[$input.attr('name')] = $input.val();
      }
    });
    console.log(id, data);
    $.ajax({
      type: 'PUT',
      url: `/api/v1/${resources}/${id}`,
      data: data
    }).done(function(res) {
      location.reload();
    });
  });

  $parent.on('click', '.delete-button', function(event) {
    var id = $(event.target).data('id');
    $.ajax({
      type: 'DELETE',
      url: `/api/v1/${resources}/${id}`,
    }).done(function(res) {
      location.reload();
    });
  });
}
  </script>
</head>
<body>
  <a href="/api/v1/auth/twitter">Sign up with Twitter</a>

  <h2>User</h2>
  <div class="user-information"></div>
  <script>
$.ajax({
  type: 'GET',
  url: '/api/v1/current_user_information'
}).done(function(res) {
  $('.user-information').html(JSON.stringify(res));
});
  </script>

  <h2>Accounts</h2>
  <div class="accounts">
    <div class="create-box">
      <input type="text" name="name" />
      <input type="number" name="amount" />
      <div class="create-button">Create amount</div>
    </div>
    <div class="update-box">
      <input type="hidden" name="id" />
      <input type="text" name="name" />
      <input type="number" name="amount" />
      <div class="update-button">Update amount</div>
    </div>
    <ul class="index-list"></ul>
  </div>
  <script>
var $accounts = $('.accounts');
function accountTemplate(account) {
  return `
    <li>
    ${account.id} / ${account.name} / ${account.amount}
    <div class="edit-button" data-content='${JSON.stringify(account)}'>Edit</div>
    <div class="delete-button" data-id="${account.id}">Delete</div>
    </li>
  `;
}
var accountData ={
  create: { name: 'wallet', amount: 1000000 },
  update: { name: 'bank', amount: Math.floor(Math.random() * 10000000) }
};
crud($accounts, 'accounts', accountTemplate, accountData);
  </script>

  <h2>TransactionCategories</h2>
  <div class="transaction-categories">
    <div class="create-button">Create transaction category(foods)</div>
    <ul class="index-list"></ul>
  </div>
  <script>
var $transactionCategories = $('.transaction-categories');
function transactionCategoryTemplate(transactionCategory) {
  return `
    <li>
      ${transactionCategory.id} / ${transactionCategory.name}
      <div class="update-button" data-id="${transactionCategory.id}">Update</div>
      <div class="delete-button" data-id="${transactionCategory.id}">Delete</div>
    </li>
  `;
}
var transactionCategoryData ={
  create: { name: 'foods' },
  update: { name: 'shopping' }
};
crud($transactionCategories, 'transaction_categories', transactionCategoryTemplate, transactionCategoryData);
  </script>

  <h2>Transactions</h2>
  <div class="transactions">
    <div class="create-button">Create transaction</div>
    <ul class="index-list"></ul>
  </div>
  <script>
var $transactions = $('.transactions');
function transactionTemplate(transaction) {
  return `
    <li>
      ${transaction.id} /
      ${(transaction.from_account) ? transaction.from_account.name : ' - '} /
      ${(transaction.to_account) ? transaction.to_account.name : ' - '} /
      ${transaction.amount} / ${transaction.transaction_category.name} /
      ${transaction.payment_date} / ${transaction.transaction_date}
      <div class="update-button" data-id="${transaction.id}">Update</div>
      <div class="delete-button" data-id="${transaction.id}">Delete</div>
    </li>
  `;
}
var transactionData ={
  create: {
    from_account_id: 1,
    to_account_id: null,
    transaction_category_id: 1,
    amount: 1000,
    payment_date: '2016/08/28',
    transaction_date: '2016/08/28'
  },
  update: {
    from_account_id: 1,
    to_account_id: 2,
    transaction_category_id: 1,
    amount: 2000,
    payment_date: '2016/08/28',
    transaction_date: '2016/08/28'
  }
};
crud($transactions, 'transactions', transactionTemplate, transactionData);
  </script>
</body>
</html>
